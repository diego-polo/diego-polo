<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sopa de Letras Paleolítico</title>
    <style>
        body {
            background: radial-gradient(circle at 60% 40%, #f5e9da 60%, #b7c9e2 100%);
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        h2 {
            text-align: center;
            color: #3b2c1a;
            text-shadow: 1px 1px 2px #fff;
        }
        .timer {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.2rem;
            font-weight: bold;
            color: #fff;
            background: linear-gradient(90deg, #7ed957 0%, #ffe066 100%);
            border-radius: 18px;
            box-shadow: 0 2px 8px #b7c9e2;
            width: 140px;
            height: 48px;
            margin: 18px auto 0 auto;
            letter-spacing: 2px;
            border: 2px solid #3b2c1a;
            text-shadow: 1px 1px 2px #3b2c1a;
        }
        .sopa-container {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            justify-content: center;
        }
        table {
            border-collapse: collapse;
            margin: 20px auto;
            background: #fffbe6;
            box-shadow: 0 4px 24px #b7c9e2;
            border-radius: 16px;
            overflow: hidden;
        }
        td {
            border: 1px solid #b7c9e2;
            width: 38px;
            height: 38px;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            user-select: none;
            background: #f5e9da;
        }
        td.selected {
            background: #ffe066;
            color: #3b2c1a;
        }
        td.found {
            background: #7ed957;
            color: #fff;
            text-shadow: 1px 1px 2px #3b2c1a;
        }
        .palabras {
            margin: 0 0 0 32px;
            width: 220px;
            min-width: 180px;
            background: #fffbe6;
            border-radius: 12px;
            box-shadow: 0 2px 12px #b7c9e2;
            padding: 18px 28px;
        }
        .palabras ul {
            list-style: none;
            padding: 0;
            columns: 1;
        }
        .palabras li {
            font-size: 20px;
            margin: 8px 0;
            display: flex;
            align-items: center;
            transition: color 0.2s;
        }
        .palabras li.found {
            color: #7ed957;
            text-decoration: line-through;
        }
        .palabras li.found::after {
            content: " ✔️";
            margin-left: 8px;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <h2>Sopa de Letras: Era Paleolítica</h2>
    <div id="timer" class="timer">01:00</div>
    <div class="sopa-container">
        <table id="sopa"></table>
        <div class="palabras">
            <strong>Palabras a encontrar:</strong>
            <ul id="palabras-lista"></ul>
        </div>
    </div>
    <script>
        // Temporizador de 1 minuto
        let tiempo = 60;
        const timerDiv = document.getElementById('timer');
        let tiempoTerminado = false;
        const timerInterval = setInterval(() => {
            tiempo--;
            let min = String(Math.floor(tiempo / 60)).padStart(2, '0');
            let seg = String(tiempo % 60).padStart(2, '0');
            timerDiv.textContent = `${min}:${seg}`;
            if (tiempo <= 0) {
                clearInterval(timerInterval);
                tiempoTerminado = true;
                timerDiv.textContent = "00:00";
                timerDiv.style.background = "#e74c3c";
                timerDiv.style.color = "#fff";
                // Redirigir automáticamente al siguiente juego
                window.location.href = "../Paleolitico/juegos_paleolitico.html";
            }
        }, 1000);

        // Palabras a buscar (elige palabras cortas para 10x10)
        const palabras = [
            "FUEGO", "CUEVA", "LANZA", "ARTE", "CAZA", "HUESO", "PIEDRA", "TRIBU", "MUJER", "TALLA"
        ];

        // Direcciones posibles: [dr, dc]
        const direcciones = [
            [0,1], [1,0], [1,1], [-1,1], [0,-1], [-1,0], [-1,-1], [1,-1]
        ];

        // Crear matriz vacía
        const N = 10;
        let sopa = Array.from({length: N}, () => Array(N).fill(''));

        // Guardar posiciones de palabras para validación
        let palabrasPos = [];

        // Colocar palabras en posiciones aleatorias
        function colocarPalabras() {
            for (const palabra of palabras) {
                let colocado = false, intentos = 0;
                while (!colocado && intentos < 200) {
                    const dir = direcciones[Math.floor(Math.random() * direcciones.length)];
                    const dr = dir[0], dc = dir[1];
                    let r = Math.floor(Math.random() * N);
                    let c = Math.floor(Math.random() * N);
                    // Verificar si cabe
                    let ok = true, camino = [];
                    for (let k = 0; k < palabra.length; k++) {
                        let nr = r + dr * k, nc = c + dc * k;
                        if (nr < 0 || nr >= N || nc < 0 || nc >= N) { ok = false; break; }
                        if (sopa[nr][nc] && sopa[nr][nc] !== palabra[k]) { ok = false; break; }
                        camino.push([nr, nc]);
                    }
                    if (ok) {
                        for (let k = 0; k < palabra.length; k++) {
                            let nr = r + dr * k, nc = c + dc * k;
                            sopa[nr][nc] = palabra[k];
                        }
                        palabrasPos.push({
                            palabra,
                            inicio: camino[0],
                            fin: camino[camino.length-1],
                            encontrada: false
                        });
                        colocado = true;
                    }
                    intentos++;
                }
            }
        }

        // Rellenar vacíos con letras aleatorias
        function rellenarSopa() {
            const letras = "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ";
            for (let i = 0; i < N; i++) {
                for (let j = 0; j < N; j++) {
                    if (!sopa[i][j]) sopa[i][j] = letras[Math.floor(Math.random() * letras.length)];
                }
            }
        }

        colocarPalabras();
        rellenarSopa();

        // Renderizar la sopa
        const tabla = document.getElementById('sopa');
        for(let i=0; i<N; i++) {
            const tr = document.createElement('tr');
            for(let j=0; j<N; j++) {
                const td = document.createElement('td');
                td.textContent = sopa[i][j];
                td.dataset.row = i;
                td.dataset.col = j;
                tr.appendChild(td);
            }
            tabla.appendChild(tr);
        }

        // Renderizar lista de palabras
        const lista = document.getElementById('palabras-lista');
        palabras.forEach(p => {
            const li = document.createElement('li');
            li.textContent = p;
            lista.appendChild(li);
        });

        // Selección de letras SOLO en línea recta
        let seleccion = [];
        let direccionSeleccion = null;

        tabla.addEventListener('mousedown', (e) => {
            if(e.target.tagName === 'TD' && !tiempoTerminado) {
                limpiarSeleccion();
                seleccionarCelda(e.target);
                seleccion = [e.target];
                direccionSeleccion = null;
                tabla.addEventListener('mouseover', seleccionarArrastre);
            }
        });
        document.addEventListener('mouseup', () => {
            if(seleccion.length > 0) {
                comprobarPalabra();
                limpiarSeleccion();
                seleccion = [];
                direccionSeleccion = null;
                tabla.removeEventListener('mouseover', seleccionarArrastre);
            }
        });

        function seleccionarArrastre(e) {
            if(e.target.tagName !== 'TD' || seleccion.includes(e.target)) return;

            const last = seleccion[seleccion.length - 1];
            const rowLast = parseInt(last.dataset.row), colLast = parseInt(last.dataset.col);
            const rowNew = parseInt(e.target.dataset.row), colNew = parseInt(e.target.dataset.col);

            if (seleccion.length === 1) {
                // Definir dirección con la segunda celda
                const dr = rowNew - rowLast;
                const dc = colNew - colLast;
                // Solo permitir direcciones válidas (horizontal, vertical, diagonal)
                if (Math.abs(dr) <= 1 && Math.abs(dc) <= 1 && (dr !== 0 || dc !== 0)) {
                    direccionSeleccion = [dr, dc];
                    seleccionarCelda(e.target);
                    seleccion.push(e.target);
                }
            } else if (direccionSeleccion) {
                // Solo permitir continuar en la misma dirección
                const prev = seleccion[seleccion.length - 1];
                const rowPrev = parseInt(prev.dataset.row), colPrev = parseInt(prev.dataset.col);
                const dr = rowNew - rowPrev;
                const dc = colNew - colPrev;
                if (dr === direccionSeleccion[0] && dc === direccionSeleccion[1]) {
                    seleccionarCelda(e.target);
                    seleccion.push(e.target);
                }
            }
        }

        function seleccionarCelda(td) {
            td.classList.add('selected');
        }
        function limpiarSeleccion() {
            document.querySelectorAll('td.selected').forEach(td => td.classList.remove('selected'));
        }

        // Comprobar si la selección es una palabra válida
        function comprobarPalabra() {
            if(seleccion.length < 2) return;
            const coords = seleccion.map(td => [parseInt(td.dataset.row), parseInt(td.dataset.col)]);
            for(const obj of palabrasPos) {
                const camino = obtenerCamino(obj.inicio, obj.fin);
                if (arraysIguales(coords, camino) && !obj.encontrada) {
                    // Marcar celdas encontradas
                    camino.forEach(([r,c]) => {
                        tabla.rows[r].cells[c].classList.add('found');
                    });
                    // Marcar palabra en la lista
                    marcarPalabraLista(obj.palabra);
                    obj.encontrada = true;
                }
            }
        }

        // Obtener camino entre dos puntos (horizontal, vertical o diagonal)
        function obtenerCamino(inicio, fin) {
            const camino = [];
            const [r1, c1] = inicio, [r2, c2] = fin;
            const dr = Math.sign(r2 - r1), dc = Math.sign(c2 - c1);
            let r = r1, c = c1;
            camino.push([r, c]);
            while(r !== r2 || c !== c2) {
                r += dr; c += dc;
                camino.push([r, c]);
            }
            return camino;
        }

        // Comparar dos arrays de coordenadas
        function arraysIguales(a, b) {
            if(a.length !== b.length) return false;
            for(let i=0; i<a.length; i++) {
                if(a[i][0] !== b[i][0] || a[i][1] !== b[i][1]) return false;
            }
            return true;
        }

        // Marcar palabra encontrada en la lista
        function marcarPalabraLista(palabra) {
            const lis = document.querySelectorAll('#palabras-lista li');
            lis.forEach(li => {
                if(li.textContent.trim().startsWith(palabra)) {
                    li.classList.add('found');
                }
            });
        }
    </script>
</body>
</html>